<!--Get home and current pages-->
{{$home := $.Site.GetPage "/"}}
{{$current := $.Page}}
{{$404 := eq $current.Kind "404"}}
{{if ne $current $home}}
<nav class="breadcrumb-header">
    <ol class="breadcrumb m-0 bg-cedreo-transparent-black-5">
        <!--get the good breadcrumb text to display for home-->
        {{$breadcrumb := $home.Title}}
        {{with $home.Params.breadcrumb}}
        {{$breadcrumb = .}}
        {{end}}

        <!--build home entry-->
        {{$ishome := eq $home $current}}
        <li class="breadcrumb-item">
            <i class="fas fa-home pr-2"></i>
            <a href="{{$home.Permalink}}">{{$breadcrumb}}</a>
        </li>

        {{if $404}}

        <!-- build 404 entry -->
        <li class="breadcrumb-item active">
            {{$.Site.Data.notfound.breadcrumb}}
        </li>

        <!--if not home, manage breadcrumb entries-->
        {{else if not $ishome}}

        <!--get the current page path and slice it-->
        {{$path := replace .File.Path "\\" "/"}}
        {{$pathslice := split $path "/"}}

        <!--rebuild all paths to that page-->
        {{range $index, $slice := $pathslice}}
        {{$page := ""}}

        <!--build the current index path-->
        {{range first (add $index 1) $pathslice}}
        {{$page = printf "%s/%s" $page .}}
        {{end}}

        <!--check we are not in an _index.md case where the page will be matched by the folder-->
        {{if not (in $page "_index.md")}}

        <!--check for taxonomy specific page and rewrite it to singular if needed (remove the last character 's') -->
        <!--we dont use the hugo singularize function here as our taxonomies are in french and galeries will be singularized as gallery and not galerie by hugo-->
        {{if isset $.Site.Taxonomies (strings.TrimPrefix "/" $page)}}
        {{$page = substr $page 0 (sub (len $page) 1)}}
        {{end}}

        <!--get the page for current index entry -->
        {{with $.Site.GetPage $page}}

        <!--get the good breadcrumb text to display-->
        {{$breadcrumb := .Title}}
        {{with .Params.breadcrumb}}
        {{$breadcrumb = .}}
        {{end}}

        <!--build the breadcrumb entry-->
        {{$iscurrent := eq $current.Permalink .Permalink}}
        <li class="breadcrumb-item {{if $iscurrent}}active{{end}}">
            {{if $iscurrent}}
            {{$breadcrumb}}
            {{else}}
            <a href="{{.Permalink}}">{{$breadcrumb}}</a>
            {{end}}
        </li>
        {{end}}
        {{end}}
        {{end}}
        {{end}}
    </ol>
</nav>
{{end}}
