{{define "main"}}

<!--Get the home gallery page config-->
{{$home := $.Site.GetPage "/galerie"}}
<!--Get the current (taxonomy) galerie page config-->
{{$current := $.Page}}

<!--we will use $home to get global values from blog configuration-->
{{$style := dict "background" (slice $home.Params.header) "content" "Fond image"}}
{{- partial "utils/block_style.html" (dict "context" $style "pagecontext" .) -}}
{{$blockstyle := .Scratch.Get "blockstyle"}}

<div class="d-flex container-fluid p-0 {{$blockstyle.cssclasses}}"
     style="{{$blockstyle.inlinestyle}}">
    <div class="d-flex flex-column w-100 minh-100">
        {{- with $home.Params.header.title | safeHTML -}}
            <h1 class="m-auto text-center">{{.}}</h1>
        {{- else -}}
            <h1 class="m-auto">{{$home.Title}}</h1>
        {{- end -}}
    </div>
</div>
<div class="container my-5 p-0">
    {{- partial "utils/taxonomies-menu.html" (dict "home" $home "current" $current "alltitle" $home.Params.alltitle "taxonomies" $.Site.Taxonomies.galeries "baseurl" "/galeries/" "context" .) -}}
</div>

<!--range over current page data (taxonomy)-->
<div class="container-fluid">
    <div class="container p-0 gallery-grid pb-5">
        {{$i := 0}}
        {{range (.Paginate (.Data.Pages.ByPublishDate.Reverse) $home.Params.imagesperpage).Pages}}
        {{$htmlid := printf "image-%s" (string $i)}}
        {{$prevhtmlid := printf "image-%s" (string (sub $i 1))}}
        {{$nexthtmlid := printf "image-%s" (string (add $i 1))}}
        {{if eq $i 0}}
        {{$prevhtmlid = ""}}
        {{else if eq $i (sub $home.Params.imagesperpage 1)}}
        {{$nexthtmlid = ""}}
        {{end}}
        {{- partial "galerie/image.html" (dict "htmlid" $htmlid "prevhtmlid" $prevhtmlid "nexthtmlid" $nexthtmlid "image" .Params.image "alt" .Params.alt "visite" .Params.visite "pagecontext" $) -}}
            {{$i = add $i 1}}
        {{end}}
    </div>
</div>
<div class="container p-0 mb-5">
    <div class="d-flex m-0 p-0">
        <div class="m-auto">
            {{template "_internal/pagination.html" .}}
        </div>
    </div>
</div>
{{end}}


{{define "canonical"}}
{{- $home := $.Site.GetPage "/galerie" -}}
{{- $paginator := .Paginate (.Data.Pages.ByPublishDate.Reverse) $home.Params.imagesperpage -}}
<link rel="canonical" href="{{$paginator.URL | absURL}}">

{{- if .Paginator.HasNext -}}
<link rel="next" href="{{ .Paginator.Next.URL | absURL }}" />
{{- end -}}
{{- if .Paginator.HasPrev -}}
<link rel="prev" href="{{ .Paginator.Prev.URL | absURL }}" />
{{- end -}}

<!-- Deal with noindex -->
{{- if not (eq 1 $paginator.PageNumber) -}}
<meta name="robots" content="noindex">
{{- end -}}

<script>
    function removeModalFade() {
        $(".modal").removeClass("fade");
        setTimeout(function () {
            $(".modal").addClass("fade")
        }, 1);
    }
</script>

{{ end }}

{{define "schema"}}
{{- with $.Page.Params.schemajson -}}
<script type="application/ld+json">
    {{ safeHTML (replace $.Page.Params.schemajson "\n" "") }}
</script>
{{- else -}}
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type":"WebPage",
        "url":"{{$.Page.Permalink}}",
        "name":"{{$.Page.Title}}",
        "inLanguage":"{{$.Site.LanguageCode}}"
    }
</script>
{{- end -}}
{{end}}